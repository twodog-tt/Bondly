# Redisç”¨æˆ·ä¿¡æ¯æ¸…é™¤è„šæœ¬

è¿™ä¸ªè„šæœ¬ç”¨äºæ¸…é™¤Bondlyé¡¹ç›®ä¸­çš„ç”¨æˆ·ç›¸å…³ç¼“å­˜æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€ä¼šè¯ã€ä»¤ç‰Œç­‰ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **ç²¾ç¡®æ¸…é™¤**ï¼šåªåˆ é™¤ç”¨æˆ·ç›¸å…³çš„ç¼“å­˜ï¼Œä¸å½±å“å…¶ä»–æ•°æ®
- ğŸ” **é¢„è§ˆæ¨¡å¼**ï¼šå¯ä»¥é¢„è§ˆå°†è¦åˆ é™¤çš„é”®ï¼Œä¸å®é™…åˆ é™¤
- ğŸ“Š **çŠ¶æ€æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå½“å‰ç¼“å­˜çŠ¶æ€å’Œåˆ é™¤ç»Ÿè®¡
- ğŸ›¡ï¸ **å®‰å…¨è¿æ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥Redisè¿æ¥çŠ¶æ€
- ğŸ¨ **å½©è‰²è¾“å‡º**ï¼šå‹å¥½çš„å½©è‰²ç»ˆç«¯è¾“å‡º

## æ”¯æŒçš„ç¼“å­˜ç±»å‹

| ç¼“å­˜ç±»å‹ | é”®æ¨¡å¼ | æè¿° |
|---------|--------|------|
| ç”¨æˆ·æ•°æ® | `bondly:user:*` | ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç¼“å­˜ |
| ç”¨æˆ·å£°èª‰ | `bondly:user:*:reputation` | ç”¨æˆ·å£°èª‰ç§¯åˆ†ç¼“å­˜ |
| ç”¨æˆ·ä½™é¢ | `bondly:user:*:balance` | ç”¨æˆ·ä»£å¸ä½™é¢ç¼“å­˜ |
| ä¼šè¯ | `bondly:session:*` | ç”¨æˆ·ä¼šè¯ç¼“å­˜ |
| ä»¤ç‰Œ | `bondly:token:*` | JWTä»¤ç‰Œç¼“å­˜ |

## ä½¿ç”¨æ–¹æ³•

### é€šè¿‡Makefileä½¿ç”¨ï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹Redisç¼“å­˜çŠ¶æ€
make redis-status

# é¢„è§ˆç”¨æˆ·ç¼“å­˜ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
make redis-clear-users-dry-run

# æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç›¸å…³ç¼“å­˜
make redis-clear-users

# åªæ¸…é™¤ä¼šè¯ç¼“å­˜
make redis-clear-sessions

# åªæ¸…é™¤ä»¤ç‰Œç¼“å­˜
make redis-clear-tokens

# åªæ¸…é™¤ç”¨æˆ·æ•°æ®ç¼“å­˜
make redis-clear-user-data
```

### ç›´æ¥ä½¿ç”¨è„šæœ¬

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./scripts/clear-redis-users.sh --help

# æŸ¥çœ‹å½“å‰ç¼“å­˜çŠ¶æ€
./scripts/clear-redis-users.sh --dry-run

# æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç›¸å…³ç¼“å­˜
./scripts/clear-redis-users.sh --all-users

# åªæ¸…é™¤ä¼šè¯ç¼“å­˜
./scripts/clear-redis-users.sh --sessions

# è¿æ¥åˆ°æŒ‡å®šçš„RedisæœåŠ¡å™¨
./scripts/clear-redis-users.sh -h 192.168.1.100 -p 6380 --all-users

# ä½¿ç”¨ä¸åŒçš„ç¼“å­˜å‰ç¼€
./scripts/clear-redis-users.sh -c myapp --all-users
```

## é…ç½®é€‰é¡¹

è„šæœ¬æ”¯æŒä»¥ä¸‹é…ç½®é€‰é¡¹ï¼š

| é€‰é¡¹ | ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | æè¿° |
|------|----------|--------|------|
| `-h, --host` | `REDIS_HOST` | `localhost` | Redisä¸»æœºåœ°å€ |
| `-p, --port` | `REDIS_PORT` | `6379` | Redisç«¯å£ |
| `-a, --password` | `REDIS_PASSWORD` | æ—  | Rediså¯†ç  |
| `-d, --db` | `REDIS_DB` | `0` | Redisæ•°æ®åº“ç¼–å· |
| `-c, --prefix` | `CACHE_PREFIX` | `bondly` | ç¼“å­˜é”®å‰ç¼€ |

## ä½¿ç”¨åœºæ™¯

### 1. å¼€å‘ç¯å¢ƒæ¸…ç†
```bash
# æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼Œé‡æ–°å¼€å§‹æµ‹è¯•
make redis-clear-users
```

### 2. ä¼šè¯ç®¡ç†
```bash
# å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·é‡æ–°ç™»å½•
make redis-clear-sessions
```

### 3. ä»¤ç‰Œåˆ·æ–°
```bash
# æ¸…é™¤æ‰€æœ‰JWTä»¤ç‰Œï¼Œå¼ºåˆ¶é‡æ–°è®¤è¯
make redis-clear-tokens
```

### 4. ç”¨æˆ·æ•°æ®é‡ç½®
```bash
# æ¸…é™¤ç”¨æˆ·æ•°æ®ç¼“å­˜ï¼Œé‡æ–°ä»æ•°æ®åº“åŠ è½½
make redis-clear-user-data
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’**ï¼š

1. **ç”Ÿäº§ç¯å¢ƒè°¨æ…ä½¿ç”¨**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿äº†è§£å½±å“
2. **å¤‡ä»½é‡è¦æ•°æ®**ï¼šæ¸…é™¤å‰å»ºè®®å¤‡ä»½é‡è¦çš„Redisæ•°æ®
3. **æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬åŠŸèƒ½
4. **æƒé™æ£€æŸ¥**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿçš„Redisè®¿é—®æƒé™

## æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
redis-cli ping

# æ£€æŸ¥ç½‘ç»œè¿æ¥
telnet localhost 6379

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
```

### æƒé™é—®é¢˜
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x scripts/clear-redis-users.sh

# æ£€æŸ¥Redisè®¿é—®æƒé™
redis-cli -a your_password ping
```

### é”®æ¨¡å¼ä¸åŒ¹é…
```bash
# æŸ¥çœ‹å®é™…çš„é”®æ¨¡å¼
redis-cli keys "*user*"

# è°ƒæ•´ç¼“å­˜å‰ç¼€
./scripts/clear-redis-users.sh -c your_prefix --dry-run
```

## ç¤ºä¾‹è¾“å‡º

### çŠ¶æ€æŸ¥çœ‹
```
ğŸ“Š å½“å‰ç¼“å­˜çŠ¶æ€

ğŸ“Š ç”¨æˆ·æ•°æ®ç¼“å­˜: 5 ä¸ªé”®
ğŸ“Š ç”¨æˆ·å£°èª‰ç¼“å­˜: 3 ä¸ªé”®
âœ… ç”¨æˆ·ä½™é¢ç¼“å­˜: æ— æ•°æ®
ğŸ“Š ä¼šè¯ç¼“å­˜: 12 ä¸ªé”®
ğŸ“Š ä»¤ç‰Œç¼“å­˜: 8 ä¸ªé”®
```

### æ¸…é™¤æ“ä½œ
```
ğŸ§¹ æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç›¸å…³ç¼“å­˜

ğŸ—‘ï¸  åˆ é™¤ ç”¨æˆ·æ•°æ®ç¼“å­˜ (5 ä¸ªé”®)...
âœ… ç”¨æˆ·æ•°æ®ç¼“å­˜ åˆ é™¤å®Œæˆ
ğŸ—‘ï¸  åˆ é™¤ ç”¨æˆ·å£°èª‰ç¼“å­˜ (3 ä¸ªé”®)...
âœ… ç”¨æˆ·å£°èª‰ç¼“å­˜ åˆ é™¤å®Œæˆ
âœ… ç”¨æˆ·ä½™é¢ç¼“å­˜: æ— æ•°æ®éœ€è¦åˆ é™¤
ğŸ—‘ï¸  åˆ é™¤ ä¼šè¯ç¼“å­˜ (12 ä¸ªé”®)...
âœ… ä¼šè¯ç¼“å­˜ åˆ é™¤å®Œæˆ
ğŸ—‘ï¸  åˆ é™¤ ä»¤ç‰Œç¼“å­˜ (8 ä¸ªé”®)...
âœ… ä»¤ç‰Œç¼“å­˜ åˆ é™¤å®Œæˆ

ğŸ‰ æ‰€æœ‰ç”¨æˆ·ç›¸å…³ç¼“å­˜æ¸…é™¤å®Œæˆï¼
```

## è´¡çŒ®

å¦‚æœæ‚¨å‘ç°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚ 